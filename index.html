<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAMS - –°–∏—Å—Ç–µ–º–∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .section-header {
            border-left: 4px solid;
            padding-left: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï –î–ê–ù–ù–´–• ---
        const STORAGE_KEY = 'pams_data';

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
        const loadData = () => {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : {
                    assets: [],
                    transactions: [],
                    valuations: {},
                    userId: 'user_' + Math.random().toString(36).substr(2, 9)
                };
            } catch (error) {
                console.error("Error loading data:", error);
                return {
                    assets: [],
                    transactions: [],
                    valuations: {},
                    userId: 'user_' + Math.random().toString(36).substr(2, 9)
                };
            }
        };

        const saveData = (data) => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (error) {
                console.error("Error saving data:", error);
            }
        };

        // --- –ò–ö–û–ù–ö–ò (SVG –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) ---
        const CheckCircle = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.6-8.5"/>
                <path d="m15 15 2 2 4-4"/>
            </svg>
        );

        const AlertTriangle = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" x2="12" y1="9" y2="13"/>
                <line x1="12" x2="12.01" y1="17" y2="17"/>
            </svg>
        );

        const Users = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );

        const DollarSign = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" x2="12" y1="2" y2="22"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );

        const History = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9h-1c-.5 0-1 .4-1 1v2c0 .5.4 1 1 1h2"/>
                <path d="M12 7v5l3 3"/>
            </svg>
        );

        const ArrowUpRight = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M7 7h10v10"/>
                <path d="M7 17 17 7"/>
            </svg>
        );

        const ArrowDownRight = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 7 7 17"/>
                <path d="M17 17H7V7"/>
            </svg>
        );

        // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò –í–ê–õ–Æ–¢–ê ---
        const AED_FORMAT = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'AED',
            minimumFractionDigits: 0
        });

        const formatAED = (value) => value ? AED_FORMAT.format(value) : 'N/A';

        const parseNumber = (value) => {
            const num = parseFloat(String(value).replace(/,/g, ''));
            return isNaN(num) ? 0 : num;
        };

        const generateId = () => 'id_' + Math.random().toString(36).substr(2, 9);

        // --- –ö–û–ú–ü–û–ù–ï–ù–¢–´ UI ---
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50">
                    <div className="bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full transform transition-all duration-300 scale-100">
                        <div className="flex justify-between items-center border-b pb-3 mb-4">
                            <h3 className="text-xl font-bold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-red-600 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        const ValuationDisplay = ({ price, date, isConfirmed, type }) => {
            const isSale = type === 'Sale';
            const textColor = isConfirmed ? 'text-green-600' : 'text-yellow-600';
            const bgColor = isConfirmed ? 'bg-green-50' : 'bg-yellow-50';
            const borderColor = isConfirmed ? 'border-green-400' : 'border-yellow-400';
            const Icon = isConfirmed ? CheckCircle : AlertTriangle;
            const statusText = isConfirmed ? '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–∞—è' : '–ù–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–∞—è (—Ç—Ä–µ–±—É–µ—Ç –û–ö)';
            const dateText = isConfirmed ? `–æ—Ç ${new Date(date).toLocaleDateString()}` : '–ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–π –¥–∞—Ç—ã';

            return (
                <div className={`p-4 rounded-xl shadow-md border-2 ${borderColor} ${bgColor} transition duration-300`}>
                    <div className="flex items-center justify-between">
                        <h4 className="text-lg font-semibold text-gray-700">{isSale ? '–¶–µ–Ω–∞ –ü—Ä–æ–¥–∞–∂–∏' : '–¶–µ–Ω–∞ –ê—Ä–µ–Ω–¥—ã'}</h4>
                        <Icon className={`w-6 h-6 ${textColor}`} />
                    </div>
                    <p className={`text-3xl font-extrabold mt-1 ${textColor}`}>
                        {formatAED(price)}
                    </p>
                    <p className="text-xs text-gray-500 mt-2">
                        <span className={`font-medium ${isConfirmed ? 'text-green-600' : 'text-yellow-600'}`}>{statusText}</span> {dateText}
                    </p>
                </div>
            );
        };

        // --- –û–°–ù–û–í–ù–û–ô –ö–û–ú–ü–û–ù–ï–ù–¢ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
        function App() {
            const [data, setData] = useState({
                assets: [],
                transactions: [],
                valuations: {},
                userId: 'user_' + Math.random().toString(36).substr(2, 9)
            });

            const [selectedAsset, setSelectedAsset] = useState(null);
            const [isTransactionModalOpen, setIsTransactionModalOpen] = useState(false);
            const [isNewAssetModalOpen, setIsNewAssetModalOpen] = useState(false);
            const [newTransaction, setNewTransaction] = useState({
                type: 'Income',
                category: '',
                amount: 0,
                description: ''
            });
            const [newAsset, setNewAsset] = useState({
                name: '–ù–æ–≤—ã–π –û–±—ä–µ–∫—Ç',
                address: '',
                acquisition_method: 'Managed',
                purchase_price: 0
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
            useEffect(() => {
                const loadedData = loadData();
                setData(loadedData);
                if (loadedData.assets.length > 0 && !selectedAsset) {
                    setSelectedAsset(loadedData.assets[0]);
                }
            }, []);

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            useEffect(() => {
                if (data.userId !== 'user_' + Math.random().toString(36).substr(2, 9)) {
                    saveData(data);
                }
            }, [data]);

            // –†–∞—Å—á–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            const profitability = useMemo(() => {
                if (!selectedAsset || !selectedAsset.id) return {
                    netProfit: 0,
                    rentability: 0,
                    roi: 0,
                    recommendation: 'N/A'
                };

                const assetTransactions = data.transactions.filter(t => t.asset_id === selectedAsset.id);
                const currentValuation = data.valuations[selectedAsset.id];

                const totalIncome = assetTransactions
                    .filter(t => t.type === 'Income')
                    .reduce((sum, t) => sum + parseNumber(t.amount), 0);
                const totalExpense = assetTransactions
                    .filter(t => t.type === 'Expense')
                    .reduce((sum, t) => sum + parseNumber(t.amount), 0);
                const netProfit = totalIncome - totalExpense;
                const purchasePrice = parseNumber(selectedAsset.purchase_price);
                const currentSalePrice = parseNumber(currentValuation?.sale_price);

                const roi = purchasePrice > 0 ? (netProfit / purchasePrice) * 100 : 0;
                const rentability = currentSalePrice > 0 ? (netProfit / currentSalePrice) * 100 : 0;

                let recommendation = '–°–¥–∞–≤–∞—Ç—å –≤ –ê—Ä–µ–Ω–¥—É';
                if (rentability < 4 && currentSalePrice > purchasePrice) {
                    recommendation = '–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ü—Ä–æ–¥–∞–∂—É';
                } else if (rentability > 7) {
                    recommendation = '–í—ã—Å–æ–∫–∞—è –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å';
                }

                return { netProfit, roi, rentability, recommendation };
            }, [selectedAsset, data.transactions, data.valuations]);

            // –§—É–Ω–∫—Ü–∏–∏ CRUD
            const handleAddAsset = () => {
                if (!newAsset.address) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞.');
                    return;
                }

                const asset = {
                    ...newAsset,
                    id: generateId(),
                    date_acquired: new Date().toISOString(),
                    size_sqft: 1200 + Math.floor(Math.random() * 500),
                    purchase_price: parseNumber(newAsset.purchase_price),
                };

                const updatedAssets = [...data.assets, asset];
                const initialValuation = {
                    is_confirmed: false,
                    sale_price: 2000000 + (Math.random() * 500000),
                    rental_price: 100000 + (Math.random() * 20000),
                    valuation_date: new Date().toISOString(),
                    data_sources: ['Bayut', 'Property Finder']
                };

                setData({
                    ...data,
                    assets: updatedAssets,
                    valuations: {
                        ...data.valuations,
                        [asset.id]: initialValuation
                    }
                });

                if (updatedAssets.length === 1) {
                    setSelectedAsset(asset);
                }

                setIsNewAssetModalOpen(false);
                setNewAsset({
                    name: '–ù–æ–≤—ã–π –û–±—ä–µ–∫—Ç',
                    address: '',
                    acquisition_method: 'Managed',
                    purchase_price: 0
                });
            };

            const handleAddTransaction = () => {
                if (!selectedAsset || !newTransaction.amount || !newTransaction.category) {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—É–º–º—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.');
                    return;
                }

                const transaction = {
                    ...newTransaction,
                    id: generateId(),
                    asset_id: selectedAsset.id,
                    amount: parseNumber(newTransaction.amount),
                    transaction_date: new Date().toISOString(),
                };

                setData({
                    ...data,
                    transactions: [transaction, ...data.transactions]
                });

                setIsTransactionModalOpen(false);
                setNewTransaction({
                    type: 'Income',
                    category: '',
                    amount: 0,
                    description: ''
                });
            };

            const requestNewValuation = () => {
                if (!selectedAsset) return;

                const newValuation = {
                    is_confirmed: false,
                    sale_price: 2200000 + (Math.random() * 100000),
                    rental_price: 120000 + (Math.random() * 5000),
                    valuation_date: new Date().toISOString(),
                    data_sources: ['Bayut', 'Property Finder', 'New Request']
                };

                setData({
                    ...data,
                    valuations: {
                        ...data.valuations,
                        [selectedAsset.id]: newValuation
                    }
                });

                alert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –Ω–æ–≤—É—é –æ—Ü–µ–Ω–∫—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! (–ò–º–∏—Ç–∞—Ü–∏—è L1)');
            };

            const confirmValuation = (assetId) => {
                const currentValuation = data.valuations[assetId];
                if (!currentValuation) return;

                const confirmedValuation = {
                    ...currentValuation,
                    is_confirmed: true,
                    confirmed_date: new Date().toISOString(),
                    data_sources: [...(currentValuation.data_sources || []), 'Confirmed by User']
                };

                setData({
                    ...data,
                    valuations: {
                        ...data.valuations,
                        [assetId]: confirmedValuation
                    }
                });

                alert('–û—Ü–µ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            };

            const renderTransactionHistory = () => {
                const filteredTransactions = data.transactions
                    .filter(t => t.asset_id === selectedAsset.id)
                    .sort((a, b) => new Date(b.transaction_date) - new Date(a.transaction_date));

                return (
                    <div className="bg-white p-5 rounded-xl shadow-lg border-t-4 border-slate-600">
                        <h2 className="text-xl font-semibold section-header mb-4 text-slate-800 border-slate-600 flex items-center">
                            <History className="w-5 h-5 mr-2" /> –ò—Å—Ç–æ—Ä–∏—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                        </h2>
                        <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
                            {filteredTransactions.length === 0 ? (
                                <p className="text-gray-500 italic">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
                            ) : (
                                filteredTransactions.map(t => {
                                    const isIncome = t.type === 'Income';
                                    const amountClass = isIncome ? 'text-green-600' : 'text-red-600';
                                    const icon = isIncome ? <ArrowUpRight className="w-4 h-4" /> : <ArrowDownRight className="w-4 h-4" />;
                                    const date = new Date(t.transaction_date).toLocaleDateString();

                                    return (
                                        <div key={t.id} className="flex justify-between items-center border-b border-gray-100 pb-2">
                                            <div>
                                                <p className="font-medium text-gray-800 flex items-center">
                                                    {icon}
                                                    <span className="ml-2">{t.description || t.category}</span>
                                                </p>
                                                <p className="text-xs text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {t.category} | {date}</p>
                                            </div>
                                            <p className={`font-bold text-base ${amountClass}`}>
                                                {isIncome ? '+' : '-'} {formatAED(t.amount)}
                                            </p>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                        <button onClick={() => setIsTransactionModalOpen(true)} className="w-full mt-4 bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 rounded-lg shadow-md transition duration-150 text-sm">
                            + –î–æ–±–∞–≤–∏—Ç—å –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                        </button>
                    </div>
                );
            };

            // –ï—Å–ª–∏ –Ω–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤
            if (data.assets.length === 0) {
                return (
                    <div className="p-8 max-w-2xl mx-auto bg-white shadow-xl rounded-xl mt-12">
                        <h1 className="text-3xl font-bold text-gray-800 mb-4">–°–∏—Å—Ç–µ–º–∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ê–∫—Ç–∏–≤–∞–º–∏ (PAMS)</h1>
                        <p className="text-gray-600 mb-6">–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏.</p>
                        <button
                            onClick={() => setIsNewAssetModalOpen(true)}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-150"
                        >
                            + –î–æ–±–∞–≤–∏—Ç—å –ù–æ–≤—ã–π –û–±—ä–µ–∫—Ç
                        </button>
                        <p className="mt-4 text-xs text-gray-400">User ID: {data.userId}</p>
                        <Modal
                            isOpen={isNewAssetModalOpen}
                            onClose={() => setIsNewAssetModalOpen(false)}
                            title="–î–æ–±–∞–≤–∏—Ç—å –ù–æ–≤—ã–π –û–±—ä–µ–∫—Ç"
                        >
                            <NewAssetForm newAsset={newAsset} setNewAsset={setNewAsset} handleAddAsset={handleAddAsset} />
                        </Modal>
                    </div>
                );
            }

            return (
                <div className="p-4 sm:p-8 bg-gray-50 min-h-screen">
                    <div className="max-w-7xl mx-auto">
                        {/* HEADER */}
                        <header className="flex justify-between items-center mb-6 p-4 bg-white shadow rounded-lg">
                            <h1 className="text-2xl font-bold text-gray-800">PAMS Dashboard</h1>
                            <div className="flex space-x-3 items-center">
                                <p className="text-sm text-gray-500 hidden sm:block">User ID: {data.userId}</p>
                                <button
                                    onClick={() => setIsNewAssetModalOpen(true)}
                                    className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 text-sm"
                                >
                                    + –ù–æ–≤—ã–π –û–±—ä–µ–∫—Ç
                                </button>
                            </div>
                        </header>

                        {/* MAIN LAYOUT */}
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            {/* –ö–û–õ–û–ù–ö–ê 1: –°–ø–∏—Å–æ–∫ –û–±—ä–µ–∫—Ç–æ–≤ */}
                            <div className="lg:col-span-1 bg-white p-4 rounded-xl shadow-lg h-full">
                                <h2 className="text-xl font-bold mb-4 text-gray-800">–û–±—ä–µ–∫—Ç—ã ({data.assets.length})</h2>
                                <ul className="space-y-2">
                                    {data.assets.map(asset => (
                                        <li key={asset.id}>
                                            <button
                                                onClick={() => setSelectedAsset(asset)}
                                                className={`w-full text-left p-3 rounded-lg transition duration-150 ${selectedAsset?.id === asset.id ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-100 hover:bg-gray-200 text-gray-800'}`}
                                            >
                                                <p className="font-semibold">{asset.name}</p>
                                                <p className="text-xs opacity-80 truncate">{asset.address}</p>
                                            </button>
                                        </li>
                                    ))}
                                </ul>
                            </div>

                            {/* –ö–û–õ–û–ù–ö–ò 2-4: –î–µ—Ç–∞–ª–∏ –û–±—ä–µ–∫—Ç–∞ */}
                            {selectedAsset && (
                                <div className="lg:col-span-3 space-y-6">
                                    {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ö–∞—Ä—Ç–æ—á–∫–∏ */}
                                    <div className="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-600">
                                        <h2 className="text-3xl font-bold text-gray-800">{selectedAsset.name}</h2>
                                        <p className="text-base text-gray-600 mt-1">{selectedAsset.address}</p>
                                    </div>

                                    {/* –†–ê–ó–î–ï–õ: –û–¶–ï–ù–ö–ê –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê */}
                                    <div className="bg-white p-6 rounded-xl shadow-lg">
                                        <h3 className="text-xl font-semibold border-l-4 border-yellow-500 pl-3 mb-4 text-gray-800 flex items-center">
                                            <DollarSign className="w-5 h-5 mr-2 text-yellow-500" /> –û—Ü–µ–Ω–∫–∞ –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <ValuationDisplay
                                                price={data.valuations[selectedAsset.id]?.sale_price}
                                                date={data.valuations[selectedAsset.id]?.valuation_date}
                                                isConfirmed={data.valuations[selectedAsset.id]?.is_confirmed}
                                                type="Sale"
                                            />
                                            <ValuationDisplay
                                                price={data.valuations[selectedAsset.id]?.rental_price}
                                                date={data.valuations[selectedAsset.id]?.valuation_date}
                                                isConfirmed={data.valuations[selectedAsset.id]?.is_confirmed}
                                                type="Rental"
                                            />
                                        </div>

                                        {/* –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –û–¶–ï–ù–ö–û–ô */}
                                        <div className="mt-4 p-4 bg-yellow-50 rounded-md border border-yellow-300">
                                            <p className="text-sm text-yellow-800 mb-3">
                                                **–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:** {formatAED(data.valuations[selectedAsset.id]?.sale_price)} (–†–∞—Å—á–µ—Ç –ø–æ {data.valuations[selectedAsset.id]?.data_sources?.join(', ') || '–ú–æ–∫–æ–≤—ã–º'} –¥–∞–Ω–Ω—ã–º)
                                            </p>
                                            <div className="flex flex-wrap gap-2">
                                                <button
                                                    onClick={() => confirmValuation(selectedAsset.id)}
                                                    className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 text-sm"
                                                    disabled={data.valuations[selectedAsset.id]?.is_confirmed}
                                                >
                                                    ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¶–µ–Ω—É (OK)
                                                </button>
                                                <button
                                                    onClick={requestNewValuation}
                                                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 text-sm"
                                                >
                                                    üîÑ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ù–æ–≤—É—é –û—Ü–µ–Ω–∫—É (L1)
                                                </button>
                                                <button className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 text-sm">
                                                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ò—Å—Ç–æ—á–Ω–∏–∫–∏
                                                </button>
                                            </div>
                                        </div>

                                        {/* –ü–û–ö–ê–ó–ê–¢–ï–õ–ò –ê–ù–ê–õ–ò–¢–ò–ö–ò */}
                                        <div className="mt-6">
                                            <h3 className="font-bold text-gray-800 mb-3">–ö–ª—é—á–µ–≤—ã–µ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏):</h3>
                                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                                                <AnalyticsCard
                                                    title="–ü—Ä–∏–±—ã–ª—å –∫ –¶–µ–Ω–µ –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è"
                                                    value={`${profitability.roi.toFixed(1)}%`}
                                                    color="green"
                                                />
                                                <AnalyticsCard
                                                    title="–ü—Ä–∏–±—ã–ª—å –∫ –¢–µ–∫—É—â–µ–π –û—Ü–µ–Ω–∫–µ"
                                                    value={`${profitability.rentability.toFixed(1)}%`}
                                                    color="purple"
                                                />
                                                <AnalyticsCard
                                                    title="–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è"
                                                    value={profitability.recommendation}
                                                    color={profitability.recommendation.includes('–ü—Ä–æ–¥–∞–∂—É') ? 'red' : 'blue'}
                                                    smallText={`–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${formatAED(profitability.netProfit)}`}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* –†–ê–ó–î–ï–õ: –£–ß–ê–°–¢–ù–ò–ö–ò –ò –†–û–õ–ò / –¢–†–ê–ù–ó–ê–ö–¶–ò–ò */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {/* –£—á–∞—Å—Ç–Ω–∏–∫–∏ */}
                                        <div className="bg-white p-5 rounded-xl shadow-lg border-t-4 border-indigo-600">
                                            <h2 className="text-xl font-semibold border-l-4 border-indigo-500 pl-3 mb-4 text-gray-800 flex items-center">
                                                <Users className="w-5 h-5 mr-2 text-indigo-500" /> –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∏ –†–æ–ª–∏
                                            </h2>
                                            <div className="space-y-3">
                                                <RoleDisplay title="–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫" value="–û–û–û '–ì–ª–æ–±–∞–ª –ò–Ω–≤–µ—Å—Ç'" color="blue" />
                                                <RoleDisplay title="–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ú–µ–Ω–µ–¥–∂–µ—Ä" value="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (user-ivp-001)" color="slate" />
                                                <RoleDisplay title="–í–Ω–µ—à–Ω–µ–µ –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ" value="Dream Estates (2% –ü—Ä–æ–¥–∞–∂–∞)" color="orange" />
                                            </div>
                                        </div>

                                        {/* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ */}
                                        {renderTransactionHistory()}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */}
                    <Modal
                        isOpen={isTransactionModalOpen}
                        onClose={() => setIsTransactionModalOpen(false)}
                        title={`–î–æ–±–∞–≤–∏—Ç—å –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–ª—è ${selectedAsset?.name}`}
                    >
                        <TransactionForm newTransaction={newTransaction} setNewTransaction={setNewTransaction} handleAddTransaction={handleAddTransaction} />
                    </Modal>

                    <Modal
                        isOpen={isNewAssetModalOpen}
                        onClose={() => setIsNewAssetModalOpen(false)}
                        title="–î–æ–±–∞–≤–∏—Ç—å –ù–æ–≤—ã–π –û–±—ä–µ–∫—Ç"
                    >
                        <NewAssetForm newAsset={newAsset} setNewAsset={setNewAsset} handleAddAsset={handleAddAsset} />
                    </Modal>
                </div>
            );
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        const AnalyticsCard = ({ title, value, color, smallText }) => {
            const colorClasses = {
                green: 'bg-green-100 text-green-700',
                purple: 'bg-purple-100 text-purple-700',
                red: 'bg-red-100 text-red-700',
                blue: 'bg-blue-100 text-blue-700',
                orange: 'bg-orange-100 text-orange-700',
                slate: 'bg-slate-100 text-slate-700',
            };
            const currentClasses = colorClasses[color] || colorClasses.blue;
            return (
                <div className={`p-4 rounded-lg shadow-sm ${currentClasses} transition duration-300 hover:shadow-lg`}>
                    <p className="text-sm text-gray-700 mb-1 font-medium">{title}</p>
                    <p className="text-2xl font-extrabold">{value}</p>
                    {smallText && <p className="text-xs mt-1 opacity-80">{smallText}</p>}
                </div>
            );
        };

        const RoleDisplay = ({ title, value, color }) => {
            const colorClasses = {
                blue: 'text-blue-600',
                orange: 'text-orange-600',
                slate: 'text-slate-600',
            };
            const currentClasses = colorClasses[color] || colorClasses.blue;
            return (
                <div className="p-3 bg-white rounded-md shadow-sm border border-gray-100">
                    <p className="text-gray-500 text-xs">{title}</p>
                    <p className={`font-semibold text-base ${currentClasses}`}>{value}</p>
                </div>
            );
        };

        const TransactionForm = ({ newTransaction, setNewTransaction, handleAddTransaction }) => (
            <div className="space-y-4">
                <div className="flex space-x-4">
                    <label className="flex items-center space-x-2">
                        <input
                            type="radio"
                            name="type"
                            value="Income"
                            checked={newTransaction.type === 'Income'}
                            onChange={(e) => setNewTransaction({ ...newTransaction, type: e.target.value })}
                            className="text-green-600 focus:ring-green-500"
                        />
                        <span className="font-medium text-green-600">–î–æ—Ö–æ–¥</span>
                    </label>
                    <label className="flex items-center space-x-2">
                        <input
                            type="radio"
                            name="type"
                            value="Expense"
                            checked={newTransaction.type === 'Expense'}
                            onChange={(e) => setNewTransaction({ ...newTransaction, type: e.target.value })}
                            className="text-red-600 focus:ring-red-500"
                        />
                        <span className="font-medium text-red-600">–†–∞—Å—Ö–æ–¥</span>
                    </label>
                </div>

                <input
                    type="number"
                    placeholder="–°—É–º–º–∞ (AED)"
                    value={newTransaction.amount || ''}
                    onChange={(e) => setNewTransaction({ ...newTransaction, amount: parseNumber(e.target.value) })}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                />
                <select
                    value={newTransaction.category}
                    onChange={(e) => setNewTransaction({ ...newTransaction, category: e.target.value })}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-700"
                >
                    <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –ö–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    <option value="Rent">–ê—Ä–µ–Ω–¥–∞ (–î–æ—Ö–æ–¥)</option>
                    <option value="Sale">–ü—Ä–æ–¥–∞–∂–∞ (–î–æ—Ö–æ–¥)</option>
                    <option value="Maintenance">–†–µ–º–æ–Ω—Ç/–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–†–∞—Å—Ö–æ–¥)</option>
                    <option value="Utilities">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (–†–∞—Å—Ö–æ–¥)</option>
                    <option value="Commission">–ö–æ–º–∏—Å—Å–∏—è –ê–≥–µ–Ω—Ç—É (–†–∞—Å—Ö–æ–¥)</option>
                    <option value="Other">–ü—Ä–æ—á–µ–µ</option>
                </select>
                <textarea
                    placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
                    value={newTransaction.description}
                    onChange={(e) => setNewTransaction({ ...newTransaction, description: e.target.value })}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 h-20"
                />

                <button onClick={handleAddTransaction} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-150 shadow-lg">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                </button>
            </div>
        );

        const NewAssetForm = ({ newAsset, setNewAsset, handleAddAsset }) => (
            <div className="space-y-4">
                <input
                    type="text"
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –û–±—ä–µ–∫—Ç–∞ (–ù–∞–ø—Ä., '–ö–≤–∞—Ä—Ç–∏—Ä–∞ JLT')"
                    value={newAsset.name}
                    onChange={(e) => setNewAsset({ ...newAsset, name: e.target.value })}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                />
                <input
                    type="text"
                    placeholder="–ê–¥—Ä–µ—Å/–õ–æ–∫–∞—Ü–∏—è (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                    value={newAsset.address}
                    onChange={(e) => setNewAsset({ ...newAsset, address: e.target.value })}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                />
                <select
                    value={newAsset.acquisition_method}
                    onChange={(e) => setNewAsset({ ...newAsset, acquisition_method: e.target.value })}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-700"
                >
                    <option value="Managed">–í –£–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</option>
                    <option value="Purchase">–ü–æ–∫—É–ø–∫–∞</option>
                    <option value="Gift">–ü–æ–¥–∞—Ä–æ–∫/–í–∑–Ω–æ—Å</option>
                </select>

                {newAsset.acquisition_method === 'Purchase' && (
                    <input
                        type="number"
                        placeholder="–¶–µ–Ω–∞ –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è (AED)"
                        value={newAsset.purchase_price || ''}
                        onChange={(e) => setNewAsset({ ...newAsset, purchase_price: parseNumber(e.target.value) })}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    />
                )}

                <button onClick={handleAddAsset} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition duration-150 shadow-lg">
                    –°–æ–∑–¥–∞—Ç—å –û–±—ä–µ–∫—Ç
                </button>
            </div>
        );

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>